#ifndef _RCC_H
#define _RCC_H

#include "io.h"
#include <stdint.h>


#define RCC_ADDR ((volatile void *)0x40021000)
#define RCC      ((rcc_t *)RCC_ADDR)


typedef struct _rcc_t rcc_t;
struct _rcc_t {
  __IO uint32_t CR;       // 0x00
  __IO uint32_t CFGR;     // 0x04
  __IO uint32_t CIR;      // 0x08
  __IO uint32_t APB2RSTR; // 0x0C
  __IO uint32_t APB1RSTR; // 0x10
  __IO uint32_t AHBENR;   // 0x14
  __IO uint32_t APB2ENR;  // 0x18
  __IO uint32_t APB1ENR;  // 0x1C
  __IO uint32_t BDCR;     // 0x20
  __IO uint32_t CSR;      // 0x24
  __IO uint32_t AHBRSTR;  // 0x28
  __IO uint32_t CFGR2;    // 0x2C
  __IO uint32_t CFGR3;    // 0x30
};


/** Clock contorl register (RCC_CR)
 * Offset: 0x00
 * Reset value: 0x0000 xx83
 */
#define RCC_CR_PLLRDY  (0x02000000)
#define RCC_CR_PLLON   (0x01000000)
#define RCC_CR_CSSON   (0x00080000)
#define RCC_CR_HSEBYP  (0x00040000)
#define RCC_CR_HSERDY  (0x00020000)
#define RCC_CR_HSEON   (0x00010000)
#define RCC_CR_HSICAL  (0x0000ff00)
#define RCC_CR_HSITRIM (0x000000f8)
#define RCC_CR_HSIRDY  (0x00000002)
#define RCC_CR_HSION   (0x00000001)


/** Clock configuration register (RCC_CFGR)
 * Offset: 0x04
 * Reset value: 0x0000 0000
 */
#define RCC_CFGR_PLLNODIV (0x80000000)
#define RCC_CFGR_MCOPRE   (0x70000000)
#define RCC_CFGR_MCOF     (0x10000000)
#define RCC_CFGR_MCO      (0x07000000)
#define RCC_CFGR_I2SSRC   (0x00800000)
#define RCC_CFGR_USBPRE   (0x00400000)
#define RCC_CFGR_PLLMUL   (0x003c0000)
#define RCC_CFGR_PLLXTPRE (0x00040000)
#define RCC_CFGR_PLLSRC   (0x00018000)
#define RCC_CFGR_PPRE2    (0x00003800)
#define RCC_CFGR_PPRE1    (0x00000700)
#define RCC_CFGR_HPRE     (0x000000f0)
#define RCC_CFGR_SWS      (0x0000000c)
#define RCC_CFGR_SW       (0x00000003)

//
#define RCC_CFGR_PLLMUL_INPUT_X_2  (0x00000000)
#define RCC_CFGR_PLLMUL_INPUT_X_3  (0x00040000)
#define RCC_CFGR_PLLMUL_INPUT_X_4  (0x00080000)
#define RCC_CFGR_PLLMUL_INPUT_X_5  (0x000c0000)
#define RCC_CFGR_PLLMUL_INPUT_X_6  (0x00100000)
#define RCC_CFGR_PLLMUL_INPUT_X_7  (0x00140000)
#define RCC_CFGR_PLLMUL_INPUT_X_8  (0x00180000)
#define RCC_CFGR_PLLMUL_INPUT_X_9  (0x001c0000)
#define RCC_CFGR_PLLMUL_INPUT_X_10 (0x00200000)
#define RCC_CFGR_PLLMUL_INPUT_X_11 (0x00240000)
#define RCC_CFGR_PLLMUL_INPUT_X_12 (0x00280000)
#define RCC_CFGR_PLLMUL_INPUT_X_13 (0x002c0000)
#define RCC_CFGR_PLLMUL_INPUT_X_14 (0x00300000)
#define RCC_CFGR_PLLMUL_INPUT_X_15 (0x00340000)
#define RCC_CFGR_PLLMUL_INPUT_X_16 (0x003c0000)


//
#define RCC_CFGR_SWS_HSI   (0x00000000)
#define RCC_CFGR_SWS_HSE   (0x00000004)
#define RCC_CFGR_SWS_PLL   (0x00000008)
#define RCC_CFGR_SWS_HSI48 (0x0000000c)

//
#define RCC_CFGR_SW_HSI   (0x00000000)
#define RCC_CFGR_SW_HSE   (0x00000001)
#define RCC_CFGR_SW_PLL   (0x00000002)
#define RCC_CFGR_SW_HSI48 (0x00000003)


/** Clock interrupt register
 * Offset: 0x08
 * Reset value: 0x0000 0000
 */
#define RCC_CIR_CSSC     (0x00800000)
#define RCC_CIR_PLLRDYC  (0x00100000)
#define RCC_CIR_HSERDYC  (0x00080000)
#define RCC_CIR_HSIRDYC  (0x00040000)
#define RCC_CIR_LSERDYC  (0x00020000)
#define RCC_CIR_LSIRDYC  (0x00010000)
#define RCC_CIR_PLLDRYIE (0x00001000)
#define RCC_CIR_HSERDYIE (0x00000800)
#define RCC_CIR_HSIRDYIE (0x00000400)
#define RCC_CIR_LSERDYIE (0x00000200)
#define RCC_CIR_LSIRDYIE (0x00000100)
#define RCC_CIR_CSSF     (0x00000010)
#define RCC_CIR_PLLRDYF  (0x00000008)
#define RCC_CIR_HSERDYF  (0x00000008)
#define RCC_CIR_HSIRDYF  (0x00000004)
#define RCC_CIR_LSERDYF  (0x00000002)
#define RCC_CIR_LSIRDYF  (0x00000001)


/** APB2 peripheral reset register(RCC_APB2RSTR)
 * Offset: 0x0C
 * Reset value: 0x0000 0000
 */
#define RCC_APB2RSTR_TIM20RST  (0x00100000)
#define RCC_APB2RSTR_TIM17RST  (0x00040000)
#define RCC_APB2RSTR_TIM16RST  (0x00020000)
#define RCC_APB2RSTR_TIM15RST  (0x00010000)
#define RCC_APB2RSTR_SPI4RST   (0x00008000)
#define RCC_APB2RSTR_USART1RST (0x00004000)
#define RCC_APB2RSTR_TIM8RST   (0x00002000)
#define RCC_APB2RSTR_SPI1RST   (0x00001000)
#define RCC_APB2RSTR_TIM1RST   (0x00000800)
#define RCC_APB2RSTR_SYSCFGRST (0x00000001)


/** APB1 peripheral reset register(RCC_APB1RSTR)
 * Offset: 0x10
 * Reset value: 0x0000 0000
 */
#define RCC_APB1RSTR_I2C3RST  (0x40000000)
#define RCC_APB1RSTR_DAC1RST  (0x20000000)
#define RCC_APB1RSTR_PWRRST   (0x10000000)
#define RCC_APB1RSTR_DAC2RST  (0x04000000)
#define RCC_APB1RSTR_CANRST   (0x02000000)
#define RCC_APB1RSTR_USBRST   (0x00800000)
#define RCC_APB1RSTR_I2C2RST  (0x00400000)
#define RCC_APB1RSTR_I2C1RST  (0x00200000)
#define RCC_APB1RSTR_UART5RST (0x00100000)
#define RCC_APB1RSTR_UART4RST (0x00080000)
#define RCC_APB1RSTR_UART3RST (0x00040000)
#define RCC_APB1RSTR_UART2RST (0x00020000)
#define RCC_APB1RSTR_SPI3RST  (0x00008000)
#define RCC_APB1RSTR_SPI2RST  (0x00004000)
#define RCC_APB1RSTR_WWDGRST  (0x00000800)
#define RCC_APB1RSTR_TIM7RST  (0x00000020)
#define RCC_APB1RSTR_TIM6RST  (0x00000010)
#define RCC_APB1RSTR_TIM4RST  (0x00000004)
#define RCC_APB1RSTR_TIM3RST  (0x00000002)
#define RCC_APB1RSTR_TIM2RST  (0x00000001)


/** AHB peripheral clock enable register(RCC_AHBENR)
 * Offset: 0x14
 * Reset value: 0x0000 0014
 */
#define RCC_APBENR_ADC34EN (0x20000000)
#define RCC_APBENR_ADC12EN (0x10000000)
#define RCC_APBENR_TSCEN   (0x01000000)
#define RCC_APBENR_IOPGEN  (0x00800000)
#define RCC_APBENR_IOPFEN  (0x00400000)
#define RCC_APBENR_IOPEEN  (0x00200000)
#define RCC_APBENR_IOPDEN  (0x00100000)
#define RCC_APBENR_IOPCEN  (0x00080000)
#define RCC_APBENR_IOPBEN  (0x00040000)
#define RCC_APBENR_IOPAEN  (0x00020000)
#define RCC_APBENR_IOPHEN  (0x00010000)
#define RCC_APBENR_CRCEN   (0x00000040)
#define RCC_APBENR_FMCEN   (0x00000020)
#define RCC_APBENR_FLITFEN (0x00000010)
#define RCC_APBENR_SRAMEN  (0x00000004)
#define RCC_APBENR_DMA2EN  (0x00000002)
#define RCC_APBENR_DMA1EN  (0x00000001)


/** APB2 peripheral clock enable register(RCC_APB2ENR)
 * Offset: 0x18
 * Reset value: 0x0000 0000
 */
#define RCC_APB2ENR_TIM20EN  (0x00100000)
#define RCC_APB2ENR_TIM17EN  (0x00040000)
#define RCC_APB2ENR_TIM16EN  (0x00020000)
#define RCC_APB2ENR_TIM15EN  (0x00010000)
#define RCC_APB2ENR_SPI4EN   (0x00008000)
#define RCC_APB2ENR_USART1EN (0x00004000)
#define RCC_APB2ENR_TIM8EN   (0x00002000)
#define RCC_APB2ENR_SPI1EN   (0x00001000)
#define RCC_APB2ENR_TIM1EN   (0x00000800)
#define RCC_APB2ENR_SYSCFGEN (0x00000001)


/** APB1 peripheral clock enable register(RCC_APB1ENR)
 * Offset: 0x1C
 * Reset value: 0x0000 0000
 */
#define RCC_APB1ENR_I2C3EN   (0x40000000)
#define RCC_APB1ENR_DAC1EN   (0x20000000)
#define RCC_APB1ENR_PWREN    (0x10000000)
#define RCC_APB1ENR_DAC2EN   (0x04000000)
#define RCC_APB1ENR_CANEN    (0x02000000)
#define RCC_APB1ENR_USBEN    (0x00800000)
#define RCC_APB1ENR_I2C2EN   (0x00400000)
#define RCC_APB1ENR_I2C1EN   (0x00200000)
#define RCC_APB1ENR_UART5EN  (0x00100000)
#define RCC_APB1ENR_UART4EN  (0x00080000)
#define RCC_APB1ENR_USART3EN (0x00040000)
#define RCC_APB1ENR_USART2EN (0x00020000)
#define RCC_APB1ENR_SPI3EN   (0x00008000)
#define RCC_APB1ENR_SPI2EN   (0x00004000)
#define RCC_APB1ENR_WWDGEN   (0x00000800)
#define RCC_APB1ENR_TIM7EN   (0x00000020)
#define RCC_APB1ENR_TIM6EN   (0x00000010)
#define RCC_APB1ENR_TIM4EN   (0x00000004)
#define RCC_APB1ENR_TIM3EN   (0x00000002)
#define RCC_APB1ENR_TIM2EN   (0x00000001)


/** RTC domain control register(RCC_BDCR)
 * Offset: 0x20
 * Reset value: 0x0000 0018
 */
#define RCC_BDCR_BDRST  (0x00010000)
#define RCC_BDCR_RTCEN  (0x00008000)
#define RCC_BDCR_RTCSEL (0x00000300)
#define RCC_BDCR_LSEDRV (0x00000018)
#define RCC_BDCR_LSEBYP (0x00000004)
#define RCC_BDCR_LSERDY (0x00000002)
#define RCC_BDCR_LSEON  (0x00000001)


/** Control/status register(RCC_CSR)
 * Offset: 0x24
 * Reset value: 0x0C00 0000
 */
#define RCC_CSR_LPWRRSTF   (0x80000000)
#define RCC_CSR_WWDGRSTF   (0x40000000)
#define RCC_CSR_IWWDGRSTF  (0x20000000)
#define RCC_CSR_SFTRSTF    (0x10000000)
#define RCC_CSR_PORRSTF    (0x08000000)
#define RCC_CSR_PINRSTF    (0x04000000)
#define RCC_CSR_OBLRSTF    (0x02000000)
#define RCC_CSR_RMVF       (0x01000000)
#define RCC_CSR_V18PWRRSTF (0x00800000)
#define RCC_CSR_LSIRDY     (0x00000002)
#define RCC_CSR_LSION      (0x00000001)


/** AHB peripheral reset register(RCC_AHBRSTR)
 * Offset: 0x28
 * Reset value: 0x0000 0000
 */
#define RCC_AHBRSTR_ADC34RST (0x20000000)
#define RCC_AHBRSTR_ADC12RST (0x10000000)
#define RCC_AHBRSTR_TSCRST   (0x01000000)
#define RCC_AHBRSTR_IOPGRST  (0x00800000)
#define RCC_AHBRSTR_IOPFRST  (0x00400000)
#define RCC_AHBRSTR_IOPERST  (0x00200000)
#define RCC_AHBRSTR_IOPDRST  (0x00100000)
#define RCC_AHBRSTR_IOPCRST  (0x00080000)
#define RCC_AHBRSTR_IOPBRST  (0x00040000)
#define RCC_AHBRSTR_IOPARST  (0x00020000)
#define RCC_AHBRSTR_IOPHRST  (0x00010000)
#define RCC_AHBRSTR_FMCRST   (0x00000020)


/** Clock configuration register(RCC_CFGR2)
 * Offset: 0x2C
 * Reset value: 0x0000 0000
 */
#define RCC_CFGR2_ADC34PRES (0x00003e00)
#define rcc_cfgr2_adc12pres (0x000001f0)
#define RCC_CFGR2_PREDIV    (0x0000000f)


/** Clock configuration register 3(RCC_CFGR3)
 * Offset: 0x30
 * Reset value: 0x0000 0000
 */
#define RCC_CFGR3_TIM34SW  (0x02000000)
#define RCC_CFGR3_TIM2SW   (0x01000000)
#define RCC_CFGR3_UART5SW  (0x00c00000)
#define RCC_CFGR3_UART4SW  (0x00300000)
#define RCC_CFGR3_USART3SW (0x000c0000)
#define RCC_CFGR3_USART2SW (0x00030000)
#define RCC_CFGR3_TIM20SW  (0x00008000)
#define RCC_CFGR3_TIM17SW  (0x00002000)
#define RCC_CFGR3_TIM16SW  (0x00000800)
#define RCC_CFGR3_TIM15SW  (0x00000400)
#define RCC_CFGR3_TIM8SW   (0x00000200)
#define RCC_CFGR3_TIM1SW   (0x00000100)
#define RCC_CFGR3_I2C3SW   (0x00000040)
#define RCC_CFGR3_I2C2SW   (0x00000020)
#define RCC_CFGR3_I2C1SW   (0x00000010)
#define RCC_CFGR3_USART1SW (0x00000003)

#endif
